<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Management - TIMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="theme.css">
    <style>
        .table-row {
            transition: all 0.24s ease-out;
        }
        
        .table-row:hover {
            background: rgba(79, 111, 104, 0.08);
            transform: translateX(4px);
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-good {
            background: var(--status-healthy);
        }
        
        .status-warning {
            background: var(--status-low);
        }
        
        .status-critical {
            background: var(--status-critical);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(8px);
        }
        
        .step-indicator {
            transition: all 0.3s ease;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }
        
        .step-indicator.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: #fff;
        }
        
        .step-indicator.completed {
            background: var(--status-healthy);
            border-color: var(--status-healthy);
            color: #fff;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 40;
            max-height: 320px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="theme-neutral overflow-x-hidden">
    <!-- Navigation -->
    <nav class="glass fixed top-0 left-0 right-0 z-50 px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-8">
                <div class="flex items-center space-x-3">
                    <div class="brand-mark w-8 h-8 rounded-lg flex items-center justify-center">
                        <span class="font-bold text-sm">T</span>
                    </div>
                    <span class="text-primary font-semibold text-lg">TIMS</span>
                </div>
                <div class="hidden md:flex space-x-6">
                    <a href="index.html" class="nav-link px-3 py-2 text-sm font-medium">Dashboard</a>
                    <a href="stock-management.html" class="nav-link active px-3 py-2 text-sm font-medium">Stock</a>
                    <a href="consumption.html" class="nav-link px-3 py-2 text-sm font-medium">Consumption</a>
                    <a href="analytics.html" class="nav-link px-3 py-2 text-sm font-medium">Analytics</a>
                </div>
            </div>
            
            <!-- Search -->
            <div class="search-container flex-1 max-w-md mx-8">
                <div class="relative">
                    <input type="text" id="stockSearch" placeholder="Search products, IDs, categories..." 
                           class="w-full bg-white/10 backdrop-blur-md border border-white/20 rounded-lg px-4 py-2 placeholder-white/70 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-400">
                    <div class="absolute right-3 top-2.5 text-muted">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center space-x-4">
                <button id="bulkActionsBtn" class="hidden bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                    Bulk Actions
                </button>
                <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full"></div>
            </div>
        </div>
    </nav>

    <!-- Header Section -->
    <section class="hero-bg pt-24 pb-8">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-primary mb-2">Stock Management</h1>
                    <p class="text-secondary">Monitor, track, and manage your inventory in real-time</p>
                </div>
                <div class="flex space-x-4">
                    <button onclick="openBulkImportModal()" class="bg-purple-500 hover:bg-purple-600 px-6 py-2 rounded-lg font-medium transition-all">
                        Bulk Import
                    </button>
                    <button onclick="openStockModal()" class="bg-cyan-500 hover:bg-cyan-600 px-6 py-2 rounded-lg font-medium transition-all">
                        Add Stock
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Stock Overview Cards -->
    <section class="py-8 -mt-4 relative z-10">
        <div class="max-w-7xl mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                            </svg>
                        </div>
                        <span class="text-blue-400 text-sm font-medium">Total Items</span>
                    </div>
                    <p class="text-2xl font-bold mb-1" id="totalItems">0</p>
                    <p class="text-gray-400 text-sm">products in system</p>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <span class="text-green-400 text-sm font-medium">In Stock</span>
                    </div>
                    <p class="text-2xl font-bold mb-1" id="inStockItems">0</p>
                    <p class="text-gray-400 text-sm">above minimum</p>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-amber-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                        </div>
                        <span class="text-amber-400 text-sm font-medium">Low Stock</span>
                    </div>
                    <p class="text-2xl font-bold mb-1" id="lowStockItems">0</p>
                    <p class="text-gray-400 text-sm">below threshold</p>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                        <span class="text-purple-400 text-sm font-medium">Total Value</span>
                    </div>
                    <p class="text-2xl font-bold mb-1" id="totalValue">$0</p>
                    <p class="text-gray-400 text-sm">inventory value</p>
                </div>
            </div>

            <!-- Filters -->
            <div class="glass rounded-xl p-6 mb-8">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium">Category:</label>
                        <select id="categoryFilter" class="bg-white/10 border border-white/20 rounded-lg px-3 py-1 text-sm text-white focus:outline-none focus:ring-2 focus:ring-cyan-400">
                            <option value="">All Categories</option>
                            <option value="Hydraulic Fluids">Hydraulic Fluids</option>
                            <option value="Engine Oils">Engine Oils</option>
                            <option value="Gear Oils">Gear Oils</option>
                            <option value="Compressor Oils">Compressor Oils</option>
                            <option value="Turbine Oils">Turbine Oils</option>
                            <option value="Greases">Greases</option>
                            <option value="Metalworking Fluids">Metalworking Fluids</option>
                            <option value="Specialty Fluids">Specialty Fluids</option>
                            <option value="Synthetic Oils">Synthetic Oils</option>
                            <option value="Food Grade">Food Grade</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium">Stock Status:</label>
                        <select id="statusFilter" class="bg-white/10 border border-white/20 rounded-lg px-3 py-1 text-sm text-white focus:outline-none focus:ring-2 focus:ring-cyan-400">
                            <option value="">All Status</option>
                            <option value="good">In Stock</option>
                            <option value="warning">Low Stock</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium">Unit:</label>
                        <select id="unitFilter" class="bg-white/10 border border-white/20 rounded-lg px-3 py-1 text-sm text-white focus:outline-none focus:ring-2 focus:ring-cyan-400">
                            <option value="">All Units</option>
                            <option value="L">Liters</option>
                            <option value="KG">Kilograms</option>
                        </select>
                    </div>
                    
                    <button onclick="clearFilters()" class="text-cyan-400 hover:text-cyan-300 text-sm font-medium transition-colors">
                        Clear Filters
                    </button>
                </div>
            </div>

            <!-- Stock Table -->
            <div class="glass rounded-xl overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-white/10">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    <input type="checkbox" id="selectAll" class="rounded border-white/20 bg-white/10 text-cyan-500 focus:ring-cyan-400">
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Product</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Category</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Current Stock</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Min. Stock</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Unit</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Cost Price</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Selling Price</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="stockTableBody" class="divide-y divide-white/10">
                            <!-- Table rows populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Floating Action Button -->
    <button class="floating-btn rounded-full p-4" onclick="openStockModal()">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
        </svg>
    </button>

    <!-- Stock Modal -->
    <div id="stockModal" class="fixed inset-0 bg-black/50 modal-backdrop z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="glass rounded-2xl p-8 max-w-2xl w-full text-white transform scale-95 opacity-0 transition-all duration-300" id="modalContent">
                <!-- Step Indicators -->
                <div class="flex items-center justify-center mb-8">
                    <div class="flex items-center space-x-4">
                        <div class="step-indicator active w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-sm font-bold">1</div>
                        <div class="w-12 h-0.5 bg-white/20"></div>
                        <div class="step-indicator w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-sm font-bold">2</div>
                        <div class="w-12 h-0.5 bg-white/20"></div>
                        <div class="step-indicator w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-sm font-bold">3</div>
                    </div>
                </div>

                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold" id="modalTitle">Add New Stock</h3>
                    <button onclick="closeStockModal()" class="text-gray-400 hover:text-cyan-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Step 1: Basic Information -->
                <div id="step1" class="modal-step">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">Product ID *</label>
                            <input type="text" id="productId" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="e.g., PROD-005" required>
                            <div id="productIdError" class="text-red-400 text-xs mt-1 hidden">Product ID already exists</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Product Name *</label>
                            <input type="text" id="productName" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="e.g., Hydraulic Oil 225" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Category *</label>
                            <select id="productCategory" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400" required>
                                <option value="">Select Category</option>
                                <option value="Hydraulic Fluids">Hydraulic Fluids</option>
                                <option value="Engine Oils">Engine Oils</option>
                                <option value="Gear Oils">Gear Oils</option>
                                <option value="Compressor Oils">Compressor Oils</option>
                                <option value="Turbine Oils">Turbine Oils</option>
                                <option value="Greases">Greases</option>
                                <option value="Metalworking Fluids">Metalworking Fluids</option>
                                <option value="Specialty Fluids">Specialty Fluids</option>
                                <option value="Synthetic Oils">Synthetic Oils</option>
                                <option value="Food Grade">Food Grade</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Unit of Measure *</label>
                            <select id="productUnit" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400" required>
                                <option value="">Select Unit</option>
                                <option value="L">Liters (L)</option>
                                <option value="KG">Kilograms (KG)</option>
                                <option value="PCS">Pieces (PCS)</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-6">
                        <label class="block text-sm font-medium mb-2">Description</label>
                        <textarea id="productDescription" rows="3" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="Product description and specifications"></textarea>
                    </div>
                </div>

                <!-- Step 2: Pricing and Stock -->
                <div id="step2" class="modal-step hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">Cost Price *</label>
                            <input type="number" id="costPrice" step="0.01" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="0.00" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Markup Percentage *</label>
                            <input type="number" id="markupPercentage" step="0.1" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="0.0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Selling Price (Auto-calculated)</label>
                            <input type="text" id="sellingPriceDisplay" readonly class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-gray-400" placeholder="0.00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Initial Stock Quantity *</label>
                            <input type="number" id="initialStock" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Minimum Stock Level *</label>
                            <input type="number" id="minStockLevel" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Supplier</label>
                            <input type="text" id="supplier" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="Supplier name">
                        </div>
                    </div>
                </div>

                <!-- Step 3: Confirmation -->
                <div id="step3" class="modal-step hidden">
                    <div class="bg-white/5 rounded-xl p-6 mb-6">
                        <h4 class="text-lg font-semibold mb-4">Review Product Details</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div><span class="text-gray-400">Product ID:</span> <span id="confirmProductId"></span></div>
                            <div><span class="text-gray-400">Name:</span> <span id="confirmProductName"></span></div>
                            <div><span class="text-gray-400">Category:</span> <span id="confirmCategory"></span></div>
                            <div><span class="text-gray-400">Unit:</span> <span id="confirmUnit"></span></div>
                            <div><span class="text-gray-400">Initial Stock:</span> <span id="confirmStock"></span></div>
                            <div><span class="text-gray-400">Cost Price:</span> <span id="confirmCost"></span></div>
                            <div><span class="text-gray-400">Selling Price:</span> <span id="confirmSelling"></span></div>
                            <div><span class="text-gray-400">Supplier:</span> <span id="confirmSupplier"></span></div>
                        </div>
                    </div>
                    <div class="bg-cyan-500/10 border border-cyan-500/30 rounded-xl p-4">
                        <div class="flex items-center space-x-3">
                            <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div>
                                <p class="font-medium text-cyan-400">Stock Alert Configuration</p>
                                <p class="text-sm text-gray-300">You'll receive notifications when stock falls below the minimum level</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="flex justify-between pt-6">
                    <button type="button" id="prevBtn" onclick="previousStep()" class="hidden border border-white/30 text-white hover:bg-white/10 px-6 py-2 rounded-lg font-medium transition-all">
                        Previous
                    </button>
                    <div class="flex space-x-4">
                        <button type="button" onclick="closeStockModal()" class="border border-white/30 text-white hover:bg-white/10 px-6 py-2 rounded-lg font-medium transition-all">
                            Cancel
                        </button>
                        <button type="button" id="nextBtn" onclick="nextStep()" class="bg-cyan-500 hover:bg-cyan-600 text-white px-6 py-2 rounded-lg font-medium transition-all">
                            Next
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Import Modal -->
    <div id="bulkImportModal" class="fixed inset-0 bg-black/50 modal-backdrop z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="glass rounded-2xl p-8 max-w-lg w-full text-white transform scale-95 opacity-0 transition-all duration-300">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold">Bulk Import</h3>
                    <button onclick="closeBulkImportModal()" class="text-gray-400 hover:text-cyan-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <div class="bg-white/5 rounded-xl p-6">
                        <h4 class="font-semibold mb-3">Upload CSV File</h4>
                        <div class="border-2 border-dashed border-white/20 rounded-lg p-8 text-center">
                            <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="text-gray-300 mb-2">Drop CSV file here or click to browse</p>
                            <p class="text-sm text-gray-400">Maximum file size: 10MB</p>
                            <input type="file" id="csvFile" accept=".csv" class="hidden">
                            <button onclick="document.getElementById('csvFile').click()" class="mt-4 bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                Choose File
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white/5 rounded-xl p-6">
                        <h4 class="font-semibold mb-3">CSV Format Requirements</h4>
                        <div class="text-sm text-gray-300 space-y-2">
                            <p>• First row must contain headers</p>
                            <p>• Required columns: Product ID, Name, Category, Stock, Unit</p>
                            <p>• Optional columns: Cost Price, Markup %, Min Stock, Supplier</p>
                            <p>• Download sample template for reference</p>
                        </div>
                        <button class="mt-4 text-cyan-400 hover:text-cyan-300 text-sm font-medium transition-colors">
                            Download Sample Template
                        </button>
                    </div>
                </div>
                
                <div class="flex space-x-4 pt-6">
                    <button onclick="closeBulkImportModal()" class="flex-1 border border-white/30 text-white hover:bg-white/10 px-6 py-2 rounded-lg font-medium transition-all">
                        Cancel
                    </button>
                    <button onclick="processBulkImport()" class="flex-1 bg-cyan-500 hover:bg-cyan-600 text-white px-6 py-2 rounded-lg font-medium transition-all">
                        Import Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Stock Management JavaScript
        let currentStep = 1;
        const totalSteps = 3;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadStockTable();
            updateOverviewCards();
            initializeFilters();
            initializeStockSearch();
        });

        // Load stock table
        function loadStockTable() {
            const tbody = document.getElementById('stockTableBody');
            const products = TIMS.data.products;
            
            const html = products.map(product => {
                const sellingPrice = (product.sellingPrice ?? (product.cost * (1 + product.markup / 100))).toFixed(2);
                const stockStatus = getStockStatus(product.stock, product.minStock);
                
                return `
                    <tr class="table-row">
                        <td class="px-6 py-4">
                            <input type="checkbox" class="product-checkbox rounded border-white/20 bg-white/10 text-cyan-500 focus:ring-cyan-400" data-product-id="${product.id}">
                        </td>
                        <td class="px-6 py-4">
                            <div>
                                <div class="text-sm font-medium text-white">${product.name}</div>
                                <div class="text-xs text-gray-400">${product.id}</div>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-300">${product.category}</td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <span class="status-indicator ${stockStatus.class}"></span>
                                <span class="text-sm font-medium text-white">${product.stock}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-300">${product.minStock}</td>
                        <td class="px-6 py-4 text-sm text-gray-300">${product.unit}</td>
                        <td class="px-6 py-4 text-sm text-gray-300">$${product.cost.toFixed(2)}</td>
                        <td class="px-6 py-4 text-sm text-white font-medium">$${sellingPrice}</td>
                        <td class="px-6 py-4">
                            <div class="flex space-x-2">
                                <button onclick="editProduct('${product.id}')" class="text-cyan-400 hover:text-cyan-300 text-sm transition-colors">
                                    Edit
                                </button>
                                <button onclick="adjustStock('${product.id}')" class="text-blue-400 hover:text-blue-300 text-sm transition-colors">
                                    Adjust
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = html;
        }

        // Get stock status
        function getStockStatus(current, minimum) {
            if (current > minimum * 2) {
                return { class: 'status-good', label: 'Good' };
            } else if (current > minimum) {
                return { class: 'status-warning', label: 'Low' };
            } else {
                return { class: 'status-critical', label: 'Critical' };
            }
        }

        // Update overview cards
        function updateOverviewCards() {
            const products = TIMS.data.products;
            const totalItems = products.length;
            const lowStockItems = products.filter(p => p.stock <= p.minStock).length;
            const inStockItems = totalItems - lowStockItems;
            const totalValue = products.reduce((sum, p) => {
                const sellingPrice = p.sellingPrice ?? (p.cost * (1 + p.markup / 100));
                return sum + (p.stock * sellingPrice);
            }, 0);
            
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('inStockItems').textContent = inStockItems;
            document.getElementById('lowStockItems').textContent = lowStockItems;
            document.getElementById('totalValue').textContent = '$' + totalValue.toLocaleString(undefined, { maximumFractionDigits: 0 });
        }

        // Modal step navigation
        function nextStep() {
            if (currentStep < totalSteps) {
                if (validateCurrentStep()) {
                    currentStep++;
                    updateModalStep();
                }
            } else {
                saveProduct();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateModalStep();
            }
        }

        function updateModalStep() {
            // Hide all steps
            document.querySelectorAll('.modal-step').forEach(step => step.classList.add('hidden'));
            
            // Show current step
            document.getElementById(`step${currentStep}`).classList.remove('hidden');
            
            // Update step indicators
            document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
                indicator.classList.remove('active', 'completed');
                if (index + 1 < currentStep) {
                    indicator.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    indicator.classList.add('active');
                }
            });
            
            // Update buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.classList.toggle('hidden', currentStep === 1);
            nextBtn.textContent = currentStep === totalSteps ? 'Save Product' : 'Next';
            
            // Update title
            const titles = ['Basic Information', 'Pricing & Stock', 'Confirmation'];
            document.getElementById('modalTitle').textContent = currentStep === totalSteps ? 'Confirm Details' : titles[currentStep - 1];
            
            // Populate confirmation step
            if (currentStep === 3) {
                populateConfirmationStep();
            }
        }

        function validateCurrentStep() {
            if (currentStep === 1) {
                const productId = document.getElementById('productId').value;
                const productName = document.getElementById('productName').value;
                const category = document.getElementById('productCategory').value;
                const unit = document.getElementById('productUnit').value;
                
                if (!productId || !productName || !category || !unit) {
                    TIMS.ui.showNotification('Validation Error', 'Please fill in all required fields', 'error');
                    return false;
                }
                
                // Check for duplicate product ID
                if (TIMS.data.products.find(p => p.id === productId)) {
                    document.getElementById('productIdError').classList.remove('hidden');
                    TIMS.ui.showNotification('Duplicate ID', 'Product ID already exists', 'error');
                    return false;
                } else {
                    document.getElementById('productIdError').classList.add('hidden');
                }
            } else if (currentStep === 2) {
                const costPrice = document.getElementById('costPrice').value;
                const markup = document.getElementById('markupPercentage').value;
                const stock = document.getElementById('initialStock').value;
                const minStock = document.getElementById('minStockLevel').value;
                
                if (!costPrice || !markup || !stock || !minStock) {
                    TIMS.ui.showNotification('Validation Error', 'Please fill in all required fields', 'error');
                    return false;
                }
            }
            return true;
        }

        function populateConfirmationStep() {
            document.getElementById('confirmProductId').textContent = document.getElementById('productId').value;
            document.getElementById('confirmProductName').textContent = document.getElementById('productName').value;
            document.getElementById('confirmCategory').textContent = document.getElementById('productCategory').value;
            document.getElementById('confirmUnit').textContent = document.getElementById('productUnit').value;
            document.getElementById('confirmStock').textContent = document.getElementById('initialStock').value;
            document.getElementById('confirmCost').textContent = '$' + parseFloat(document.getElementById('costPrice').value).toFixed(2);
            
            const cost = parseFloat(document.getElementById('costPrice').value);
            const markup = parseFloat(document.getElementById('markupPercentage').value);
            const sellingPrice = cost * (1 + markup / 100);
            document.getElementById('confirmSelling').textContent = '$' + sellingPrice.toFixed(2);
            
            const supplier = document.getElementById('supplier').value || 'Not specified';
            document.getElementById('confirmSupplier').textContent = supplier;
        }

        // Price calculation
        function initializePriceCalculation() {
            const costPrice = document.getElementById('costPrice');
            const markup = document.getElementById('markupPercentage');
            const sellingPrice = document.getElementById('sellingPriceDisplay');
            
            function calculatePrice() {
                const cost = parseFloat(costPrice.value) || 0;
                const mark = parseFloat(markup.value) || 0;
                const price = cost * (1 + mark / 100);
                sellingPrice.value = '$' + price.toFixed(2);
            }
            
            costPrice.addEventListener('input', calculatePrice);
            markup.addEventListener('input', calculatePrice);
        }

        // Save product
        function saveProduct() {
            const baseProduct = {
                id: document.getElementById('productId').value,
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                stock: parseInt(document.getElementById('initialStock').value),
                unit: document.getElementById('productUnit').value,
                cost: parseFloat(document.getElementById('costPrice').value),
                markup: parseFloat(document.getElementById('markupPercentage').value),
                minStock: parseInt(document.getElementById('minStockLevel').value),
                description: document.getElementById('productDescription').value,
                supplier: document.getElementById('supplier').value
            };
            const computedSellingPrice = baseProduct.cost * (1 + baseProduct.markup / 100);
            const newProduct = {
                ...baseProduct,
                sellingPrice: Number(computedSellingPrice.toFixed(2)),
                remaining: baseProduct.stock,
                purchaseDate: new Date().toISOString().split('T')[0]
            };
            
            TIMS.data.products.push(newProduct);
            loadStockTable();
            updateOverviewCards();
            closeStockModal();
            TIMS.ui.showNotification('Success', `${newProduct.name} has been added to inventory`);
        }

        // Modal functions
        function openStockModal() {
            const modal = document.getElementById('stockModal');
            const content = document.getElementById('modalContent');
            
            modal.classList.remove('hidden');
            currentStep = 1;
            updateModalStep();
            
            setTimeout(() => {
                content.style.transform = 'scale(1)';
                content.style.opacity = '1';
            }, 10);
        }

        function closeStockModal() {
            const modal = document.getElementById('stockModal');
            const content = document.getElementById('modalContent');
            
            content.style.transform = 'scale(0.95)';
            content.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
                // Reset form
                document.getElementById('stockForm').reset();
                currentStep = 1;
            }, 300);
        }

        // Bulk import modal
        function openBulkImportModal() {
            const modal = document.getElementById('bulkImportModal');
            const content = modal.querySelector('.glass');
            
            modal.classList.remove('hidden');
            
            setTimeout(() => {
                content.style.transform = 'scale(1)';
                content.style.opacity = '1';
            }, 10);
        }

        function closeBulkImportModal() {
            const modal = document.getElementById('bulkImportModal');
            const content = modal.querySelector('.glass');
            
            content.style.transform = 'scale(0.95)';
            content.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function processBulkImport() {
            TIMS.ui.showNotification('Import Started', 'Processing CSV file...');
            closeBulkImportModal();
            // Simulate processing
            setTimeout(() => {
                TIMS.ui.showNotification('Import Complete', 'Successfully imported 25 products');
                loadStockTable();
                updateOverviewCards();
            }, 2000);
        }

        // Initialize filters
        function initializeFilters() {
            const categoryFilter = document.getElementById('categoryFilter');
            const statusFilter = document.getElementById('statusFilter');
            const unitFilter = document.getElementById('unitFilter');
            
            [categoryFilter, statusFilter, unitFilter].forEach(filter => {
                filter.addEventListener('change', applyFilters);
            });
        }

        function applyFilters() {
            const category = document.getElementById('categoryFilter').value;
            const status = document.getElementById('statusFilter').value;
            const unit = document.getElementById('unitFilter').value;
            
            const rows = document.querySelectorAll('#stockTableBody tr');
            
            rows.forEach(row => {
                const categoryCell = row.cells[2].textContent;
                const stockCell = row.cells[3].querySelector('.status-indicator');
                const unitCell = row.cells[5].textContent;
                
                let showRow = true;
                
                if (category && categoryCell !== category) showRow = false;
                if (unit && unitCell !== unit) showRow = false;
                if (status) {
                    const hasStatus = stockCell.classList.contains(`status-${status}`);
                    if (!hasStatus) showRow = false;
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        function clearFilters() {
            document.getElementById('categoryFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('unitFilter').value = '';
            applyFilters();
        }

        // Initialize stock search
        function initializeStockSearch() {
            const searchInput = document.getElementById('stockSearch');
            
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('#stockTableBody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(query) ? '' : 'none';
                });
            });
        }

        // Product actions
        function editProduct(productId) {
            TIMS.ui.showNotification('Edit Product', `Editing ${productId} - Feature coming soon`);
        }

        function adjustStock(productId) {
            TIMS.ui.showNotification('Adjust Stock', `Adjusting stock for ${productId} - Feature coming soon`);
        }

        // Initialize price calculation when modal opens
        document.addEventListener('click', function(e) {
            if (e.target.onclick && e.target.onclick.toString().includes('openStockModal')) {
                setTimeout(initializePriceCalculation, 100);
            }
        });
    </script>
    <script type="module" src="main.js"></script>
</body>
</html>

